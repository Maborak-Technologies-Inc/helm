# Default values for amazon-watcher-stack
# This is a YAML-formatted file.

nameOverride: "apt"
fullnameOverride: ""

# Global configuration
global:
  context: amazon-watcher
  domain:
    ui: ui.amazon-watcher.local
    backend: api.amazon-watcher.local

# Database Configuration
database:
  enabled: true
  postgres:
    version: "16-alpine"
    db: amazon_watcher
    user: amazon_watcher
    password: amazon_watcher_password
    port: 5432
    dataPath: /var/lib/postgresql/data/pgdata
  storage:
    storageClassName: ""
    size: 10Gi
    accessModes:
      - ReadWriteOnce
  resources:
    limits:
      memory: 1Gi
      cpu: 1000m
    requests:
      memory: 512Mi
      cpu: 500m
  healthCheck:
    enabled: true
    intervalSeconds: 5
    timeoutSeconds: 5
    failureThreshold: 5
    initialDelaySeconds: 10

# Backend Service Configuration
backend:
  enabled: true
  replicas: 1
  image:
    repository: maborak/platform
    tag: "apt-backend-0.1"
    pullPolicy: Always
  resources:
    limits:
      memory: 1Gi
      cpu: 1000m
    requests:
      memory: 512Mi
      cpu: 500m
  service:
    type: ClusterIP  # Options: ClusterIP, NodePort, LoadBalancer
    # nodePort: 30090  # Only used if type is NodePort
  healthCheck:
    enabled: true
    path: /health
    port: 9000
    initialDelaySeconds: 40
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  # Backend environment variables (APT_BACKEND_* prefix)
  # All env vars with full names including prefix - no transformation needed
  env:
    APT_BACKEND_DATABASE_URL: "postgresql://postgres:Dgo7cQ41WDTnd89G46TgfVtr@192.168.0.27:5551/amazon"  # External database URL
    APT_BACKEND_DB_ECHO: "false"
    APT_BACKEND_DB_ECHO_POOL: "false"
    APT_BACKEND_DB_POOL_SIZE: "20"
    APT_BACKEND_DB_MAX_OVERFLOW: "30"
    APT_BACKEND_DB_POOL_TIMEOUT: "30"
    APT_BACKEND_DB_POOL_RECYCLE: "3600"
    APT_BACKEND_DB_USE_REPLICA_ENGINE: "false"
    APT_BACKEND_UVI_HOST: "0.0.0.0"
    APT_BACKEND_UVI_PORT: "9000"
    APT_BACKEND_RELOAD: "false"
    APT_BACKEND_LOG_LEVEL: "info"
    APT_BACKEND_DEBUG_MODE: "false"
    APT_BACKEND_UVI_ACCESS_LOG: "true"
    APT_BACKEND_UVI_WORKERS: "5"
    APT_BACKEND_UVI_LIMIT_CONCURRENCY: "100"
    APT_BACKEND_UVI_LIMIT_MAX_REQUESTS: "1000"
    APT_BACKEND_UVI_TIMEOUT_KEEP_ALIVE: "30"
    APT_BACKEND_UVI_TIMEOUT_GRACEFUL_SHUTDOWN: "30"
    APT_BACKEND_JWT_ALGORITHM: "HS256"
    APT_BACKEND_JWT_ACCESS_TOKEN_EXPIRY: "3600"
    APT_BACKEND_JWT_REFRESH_TOKEN_EXPIRY: "2592000"
    APT_BACKEND_CORS_ORIGINS: "*"
    APT_BACKEND_CORS_ALLOW_CREDENTIALS: "true"
    APT_BACKEND_CORS_ALLOW_METHODS: "*"
    APT_BACKEND_CORS_ALLOW_HEADERS: "*"
    APT_BACKEND_CORS_EXPOSE_HEADERS: ""
    APT_BACKEND_CORS_MAX_AGE: "600"
    APT_BACKEND_RATE_LIMIT_ENABLED: "true"
    APT_BACKEND_RATE_LIMIT_REQUESTS: "20"
    APT_BACKEND_RATE_LIMIT_WINDOW: "60"
    APT_BACKEND_RATE_LIMIT_BYPASS_KEY: ""
    APT_BACKEND_RATE_LIMIT_EXCLUDED_PATHS: "/docs,/redoc,/openapi.json,/favicon.ico,/health"
    APT_BACKEND_RATE_LIMIT_BYPASS_PATHS: ""
    APT_BACKEND_MONITOR_ENABLED: "false"
    APT_BACKEND_MONITOR_INTERVAL: "3600"
    APT_BACKEND_MONITOR_BATCH_SIZE: "5"
    APT_BACKEND_PRICE_HISTORY_PERIODIC_SECONDS: "3600"
    APT_BACKEND_DEFAULT_COUNTRY: "BO"
    APT_BACKEND_HTTP_ENGINE: "requests"
    APT_BACKEND_HTTP_TIMEOUT: "10.0"
    APT_BACKEND_HTTP_RETRIES: "1"
    APT_BACKEND_HTTP_MAX_CONNECTIONS: "10"
    APT_BACKEND_SCREENSHOT_ENABLED: "true"
    APT_BACKEND_SCREENSHOT_ON_PRICE_CHANGE_ONLY: "false"
    APT_BACKEND_SCREENSHOT_ON_CHANGES: "false"
    APT_BACKEND_SCREENSHOT_ALWAYS: "true"
    APT_BACKEND_SCREENSHOT_MAX_RETRIES: "3"
    APT_BACKEND_SCREENSHOT_STORAGE_PATH: "./var/screenshots"
    APT_BACKEND_SCREENSHOT_SERVICE_URL: ""  # Auto-generated from screenshot service if empty
    APT_BACKEND_SCREENSHOT_SERVICE_WIDTH: "1200"
    APT_BACKEND_SCREENSHOT_SERVICE_HEIGHT: "960"
    APT_BACKEND_SCREENSHOT_SERVICE_FULL_PAGE: "false"
    APT_BACKEND_SCREENSHOT_SERVICE_JAVASCRIPT_ENABLED: "false"
    APT_BACKEND_SCREENSHOT_SERVICE_STOP_ON_CAPTCHA: "false"
    APT_BACKEND_SCREENSHOT_SERVICE_BROWSER_TYPE: "chromium"
    APT_BACKEND_BENCH_KEY: ""
    APT_BACKEND_TEST_MODE: "false"
  # Screenshot storage volume
  screenshotStorage:
    enabled: true
    storageClassName: ""
    size: 5Gi
    accessModes:
      - ReadWriteOnce

# UI Service Configuration
ui:
  enabled: true
  replicas: 1
  image:
    repository: maborak/platform
    tag: "apt-ui-0.1"
    pullPolicy: Always
  resources:
    limits:
      memory: 2Gi
      cpu: 500m
    requests:
      memory: 512Mi
      cpu: 100m
  service:
    type: ClusterIP  # Options: ClusterIP, NodePort, LoadBalancer
    # nodePort: 30080  # Only used if type is NodePort
  healthCheck:
    enabled: true
    path: /
    port: 80
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  # UI environment variables (VITE_* prefix)
  # All env vars with full names including prefix - no transformation needed
  env:
    VITE_API_BASE_URL: ""  # Auto-generated from backend domain if empty (uses //api.amazon-watcher.local)
    VITE_API_TIMEOUT: "30"
    VITE_CONNECTIVITY_CHECK_INTERVAL: "60"
    VITE_APP_NAME: "Amazon Watcher"
    VITE_APP_VERSION: "1.0.0"
    VITE_BUILD_DATE: ""
    VITE_PRICE_HISTORY_LIMIT: "50"
    VITE_PRICE_HISTORY_PAGE_SIZE: "10"
    VITE_DEBUG_MODE: "true"
    VITE_LOG_LEVEL: "info"

# Screenshot Service Configuration
screenshot:
  enabled: true
  replicas: 1
  image:
    repository: maborak/platform
    tag: "apt-browser-0.1"
    pullPolicy: Always
  resources:
    limits:
      memory: 2Gi
      cpu: 1000m
    requests:
      memory: 1Gi
      cpu: 500m
  service:
    type: ClusterIP  # Options: ClusterIP, NodePort, LoadBalancer
    # nodePort: 30300  # Only used if type is NodePort
  healthCheck:
    enabled: true
    path: /health
    port: 3000
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  # Argo Rollout configuration
  rollout:
    revisionHistoryLimit: 10  # Number of old ReplicaSets to retain
    # Deployment strategy (optional - defaults to simple canary with no steps)
    # If not specified, uses canary strategy with empty steps (rolling update behavior)
    # strategy:
    #   canary:
    #     steps:
    #     - setWeight: 10
    #     - pause: {}
    #     - setWeight: 50
    #     - pause: {duration: 5m}
    #     - setWeight: 100
    #   blueGreen:
    #     activeService: screenshot
    #     previewService: screenshot-preview
    #     autoPromotionEnabled: true
  # Horizontal Pod Autoscaler configuration
  autoscaling:
    enabled: true
    minReplicas: 5
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: null  # Set to enable memory-based scaling
    # Optional: Custom scaling behavior
    # behavior:
    #   scaleDown:
    #     stabilizationWindowSeconds: 300
    #     policies:
    #     - type: Percent
    #       value: 50
    #       periodSeconds: 60
    #   scaleUp:
    #     stabilizationWindowSeconds: 0
    #     policies:
    #     - type: Percent
    #       value: 100
    #       periodSeconds: 60
    #     - type: Pods
    #       value: 2
    #       periodSeconds: 60
    #     selectPolicy: Max
  # Browser environment variables (APT_BROWSER_* prefix)
  # All env vars with full names including prefix - no transformation needed
  env:
    APT_BROWSER_HOST: "0.0.0.0"
    APT_BROWSER_PORT: "3000"
    APT_BROWSER_RELOAD: "false"
    APT_BROWSER_WORKERS: "1"
    APT_BROWSER_LOG_LEVEL: "INFO"
    APT_BROWSER_ACCESS_LOG: "true"
    APT_BROWSER_LIMIT_CONCURRENCY: "100"
    APT_BROWSER_LIMIT_MAX_REQUESTS: "1000"
    APT_BROWSER_TIMEOUT_KEEP_ALIVE: "5"
    APT_BROWSER_TIMEOUT_GRACEFUL_SHUTDOWN: "30"
    APT_BROWSER_BROWSER_HEADLESS: "true"
    APT_BROWSER_BROWSER_TIMEOUT: "30000"
    APT_BROWSER_BROWSER_IDLE_TIMEOUT: "300"
    APT_BROWSER_MAX_CONCURRENT: "100"
    APT_BROWSER_REQUEST_TIMEOUT: "120"
    APT_BROWSER_DEFAULT_WIDTH: "1920"
    APT_BROWSER_DEFAULT_HEIGHT: "1080"
    APT_BROWSER_DEFAULT_FULL_PAGE: "false"
    APT_BROWSER_DEFAULT_WAIT_UNTIL: "networkidle"
    APT_BROWSER_DEFAULT_MAX_RETRIES: "3"
    APT_BROWSER_DEFAULT_STOP_ON_CAPTCHA: "false"
    APT_BROWSER_DEFAULT_JAVASCRIPT_ENABLED: "true"
    APT_BROWSER_DEFAULT_BROWSER_TYPE: "chromium"
    APT_BROWSER_CAPTCHA_SCROLL_STEP: "500"
    APT_BROWSER_CAPTCHA_RETRY_DELAY_MIN: "2.0"
    APT_BROWSER_CAPTCHA_RETRY_DELAY_MAX: "4.0"
    APT_BROWSER_NAVIGATION_MAX_RETRIES: "3"
    APT_BROWSER_USER_AGENT: "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36"

# Kubernetes Ingress Configuration
# Works with any ingress controller (NGINX, Traefik, etc.)
# Note: Ingress resources are only created if both enabled=true AND className is set
ingress:
  enabled: true
  className: "nginx"  # Set to your ingress controller class (e.g., "nginx", "traefik"). If empty, Ingress resources will not be created.
  
  # TLS/SSL Configuration
  tls:
    enabled: false
    # If enabled, you need to provide TLS certificates
    # You can use cert-manager for automatic certificate management
    # or manually create TLS secrets

# Secrets (sensitive values)
secrets:
  # Database password (if not using database.postgres.password)
  databasePassword: ""
  # JWT secret for backend
  jwtSecret: "your-super-secret-jwt-key-here-change-this-in-production"

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod Security Context
podSecurityContext:
  fsGroup: 2000
  runAsNonRoot: true
  runAsUser: 1000

# Security Context
securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false

# Node Selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Annotations
podAnnotations: {}

# Labels
podLabels: {}

# ArgoCD Configuration
argocd:
  # ArgoCD annotations for sync control and metadata
  annotations:
    # Application metadata (similar to Upwork pattern)
    app.maborak.com/contact: ""  # e.g., "team@maborak.com"
    app.maborak.com/created-by: "argo-cd"  # Indicates ArgoCD created this resource
    app.maborak.com/department: ""  # e.g., "platform", "engineering"
    app.maborak.com/project: ""  # e.g., "amazon-watcher"
    
    # Argo Rollouts notifications (Slack, etc.)
    # notifications.argoproj.io/subscribe.on-rollout-aborted.slack: "channel-name"
    # notifications.argoproj.io/subscribe.on-rollout-completed.slack: "channel-name"
    # notifications.argoproj.io/subscribe.on-rollout-step-completed.slack: "channel-name"
    # notifications.argoproj.io/subscribe.on-rollout-updated.slack: "channel-name"
    
    # Sync control annotations
    # argocd.argoproj.io/sync-wave: "0"  # Lower numbers sync first
    # argocd.argoproj.io/sync-options: "Prune=false"  # Comma-separated options
    # argocd.argoproj.io/hook: "PreSync"  # Hook type: PreSync, PostSync, Sync, Skip
    # argocd.argoproj.io/hook-weight: "0"  # Hook execution order
    # argocd.argoproj.io/refresh: "hard"  # Refresh mode: normal, hard
    # argocd.argoproj.io/compare-options: "IgnoreExtraneous"  # Compare options
    
  # Application labels (similar to Upwork pattern)
  labels:
    # Standard Kubernetes labels (already included in common labels)
    # app.kubernetes.io/name, app.kubernetes.io/instance, app.kubernetes.io/component
    # app.kubernetes.io/managed-by, app.kubernetes.io/version, app.kubernetes.io/part-of
    
    # Organization-specific labels
    app.maborak.com/bounded-context: ""  # Domain/bounded context
    app.maborak.com/chart-name: "amazon-watcher-stack"  # Helm chart name
    app.maborak.com/cluster-name: ""  # Kubernetes cluster name
    app.maborak.com/environment: "Development"  # Environment: prod, staging, dev
    app.maborak.com/family: ""  # Technology family: backend, frontend, database
    app.maborak.com/runtime: ""  # Runtime: eks, gke, aks, docker-desktop
    app.maborak.com/service-runtime: ""  # Service runtime: nodejs, python, go
    app.maborak.com/team: ""  # Team name
    app.maborak.com/tier: ""  # Application tier: T1, T2, T3
    app.maborak.com/type: ""  # Application type: business, infrastructure, platform
    
    # ArgoCD instance label
    argocd.argoproj.io/instance: ""  # ArgoCD application instance name
    
    # Platform-specific labels
    platform.maborak.com/namespace: ""  # Target namespace
    # platform.maborak.com/network-policies-version: ""
    # platform.maborak.com/istio-telemetry-api-flag: ""
    
  # Legacy tags (deprecated - use labels instead, but kept for backward compatibility)
  tags:
    environment: "Development"  # Maps to app.maborak.com/environment
    team: ""  # Maps to app.maborak.com/team
    project: ""  # Maps to app.maborak.com/project
